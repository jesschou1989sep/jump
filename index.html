<!doctype html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Facebook App 直開連結產生器｜Linktree 可用</title>
  <meta name="description" content="將任何 Facebook 連結轉為可嘗試直接用 Facebook App 開啟的連結，放進 Linktree / IG / FB 內建瀏覽器也可用。" />
  <style>
    :root{--bg:#0b0f15;--fg:#e8eef7;--muted:#97a3b6;--card:#121826;--accent:#5ab0ff;--ok:#51d37a;--err:#ff7a7a}
    *{box-sizing:border-box}html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0b0f15,#0f1522);color:var(--fg);font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Helvetica, Arial}
    .container{max-width:860px;margin:40px auto;padding:24px}
    .card{background:var(--card);border:1px solid #242c3a;border-radius:16px;padding:24px;box-shadow:0 10px 30px rgba(0,0,0,0.35)}
    h1{font-size:22px;margin:0 0 12px}
    p.lead{color:var(--muted);margin-top:0}
    label{display:block;margin:10px 0 6px;color:#c9d7ee}
    input[type="url"], input[type="text"]{width:100%;padding:14px 16px;border-radius:12px;border:1px solid #2c3649;background:#0d1220;color:var(--fg)}
    .row{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
    button{appearance:none;border:0;border-radius:12px;padding:12px 16px;background:var(--accent);color:#021528;font-weight:700;cursor:pointer}
    button.secondary{background:#25324a;color:#d7e6ff}
    button.ghost{background:transparent;border:1px solid #2c3649;color:#b8c7e6}
    .muted{color:var(--muted)}
    .badge{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid #2c3649;color:#a9b8d6;font-size:12px}
    .hide{display:none}
    .success{color:var(--ok)}
    .error{color:var(--err)}
    .mini{font-size:12px;color:#a4b4d2}
    .center{display:flex;align-items:center;justify-content:center;height:60vh;text-align:center}
  </style>
  <script>
    // --- Redirect Mode (visit with ?u=...) ---
    (function immediateRedirect(){
      const q = new URLSearchParams(location.search);
      const u = q.get('u');
      if(!u) return; // not in redirect mode
      // Try to open the Facebook app instantly. We render nothing.
      const target = decodeURIComponent(u);
      // Known trick that works in iOS/Android FB app: open facewebmodal to keep login context
      const fbScheme = 'facebook://facewebmodal/f?href=' + encodeURIComponent(target);
      const fbSchemeAlt = 'fb://facewebmodal/f?href=' + encodeURIComponent(target); // some Android variants
      const fbIntent = 'intent://facewebmodal/f?href=' + encodeURIComponent(target) + '#Intent;scheme=fb;package=com.facebook.katana;end';

      // Quick path: if we're already inside Facebook in-app browser, this should jump without needing timers.
      const ua = navigator.userAgent || '';
      const isAndroid = /Android/i.test(ua);

      // Try scheme first
      try { location.replace(fbScheme); } catch(e) {}

      // Fallback chain
      setTimeout(function(){
        try { location.replace(fbSchemeAlt); } catch(e) {}
      }, 120);

      // Android intent fallback
      if(isAndroid){
        setTimeout(function(){ location.replace(fbIntent); }, 250);
      }

      // Final hard fallback to the original https URL (web). Still keeps FB login if inside FB app.
      setTimeout(function(){ location.replace(target); }, 700);

      // Prevent any flash of generator UI
      document.documentElement.style.background = '#0b0f15';
      document.body.innerHTML = '';
    })();
  </script>
</head>
<body>
  <div id="app" class="container">
    <div class="card" id="generator">
      <h1>Facebook App 直開連結產生器</h1>
      <p class="lead">把 <strong>粉專 / 私密社團 / 貼文</strong> 的網址貼上，產生一個 <span class="badge">Linktree 可用</span> 的中繼連結。當用戶在 <strong>Facebook App</strong> 內點擊時，將嘗試直接在 App 內開啟（避免跳到未登入的網頁）。</p>

      <label for="fbUrl">貼上 Facebook 連結（例如：粉專、社團、貼文）</label>
      <input type="url" id="fbUrl" placeholder="https://www.facebook.com/groups/xxxxxxxx 或 https://www.facebook.com/yourpage" inputmode="url" />

      <div class="row">
        <button id="gen">產生直開連結</button>
        <button id="test" class="secondary">在本頁測試</button>
        <button id="copy" class="ghost">複製連結</button>
      </div>

      <div id="outWrap" class="hide" style="margin-top:14px">
        <label for="out">產生結果（可放進 Linktree / IG Bio / 網站）</label>
        <input type="text" id="out" readonly />
        <p class="mini">提示：把上面這個連結放到 Linktree。使用者在 Facebook App 內點擊時，會嘗試以 App 直接開啟你的目標連結。</p>
        <p id="msg" class="mini"></p>
      </div>

      <hr style="border:0;border-top:1px solid #2c3649;margin:20px 0">
      <p class="mini">注意：
        <br>1) 若裝置未安裝 Facebook App，或系統限制自動喚起 App，將回退到原網址的網頁版。
        <br>2) 私密社團仍須使用者已登入該 App 帳號方能查看（本工具的目的是避免跳到未登入的瀏覽器）。
      </p>
    </div>
  </div>

  <script>
    (function(){
      const $ = (s)=>document.querySelector(s);
      const fbUrl = $('#fbUrl');
      const outWrap = $('#outWrap');
      const out = $('#out');
      const msg = $('#msg');

      function currentBase(){
        // Generate link to this same page with ?u=... so it works after you upload to GitHub Pages
        // Handles both /index.html and /repo-name/ paths
        const url = new URL(location.href);
        // Keep only origin + pathname (strip any ?u=… if present)
        url.search = '';
        url.hash = '';
        return url.toString();
      }

      function makeLink(raw){
        if(!raw) return null;
        try{ new URL(raw); }catch(e){ return null; }
        const base = currentBase();
        const u = encodeURIComponent(raw);
        const link = base + (base.includes('?') ? '&' : '?') + 'u=' + u;
        return link;
      }

      function copyToClipboard(text){
        return navigator.clipboard?.writeText(text).then(()=>true).catch(()=>{
          const ta = document.createElement('textarea');
          ta.value = text; document.body.appendChild(ta); ta.select();
          const ok = document.execCommand('copy'); document.body.removeChild(ta); return ok;
        });
      }

      $('#gen').addEventListener('click', ()=>{
        const link = makeLink(fbUrl.value.trim());
        msg.textContent = '';
        if(!link){ msg.textContent = '請輸入有效的 Facebook 網址。'; msg.className='mini error'; outWrap.classList.add('hide'); return; }
        out.value = link; outWrap.classList.remove('hide'); msg.textContent = '已產生直開連結。'; msg.className='mini success';
      });

      $('#copy').addEventListener('click', async()=>{
        if(!out.value){ msg.textContent='請先產生連結。'; msg.className='mini error'; return; }
        const ok = await copyToClipboard(out.value);
        msg.textContent = ok ? '已複製！' : '複製失敗，請手動複製。';
        msg.className = ok ? 'mini success' : 'mini error';
      });

      $('#test').addEventListener('click', ()=>{
        const link = makeLink(fbUrl.value.trim());
        if(!link){ msg.textContent = '請輸入有效的 Facebook 網址。'; msg.className='mini error'; return; }
        location.href = link; // navigate into redirect mode
      });

      // Quality-of-life: auto-fill from clipboard if it already contains a FB URL
      (async function tryReadClipboard(){
        try{
          const txt = await navigator.clipboard.readText();
          if(/^https?:\/\/(?:m\.)?(?:www\.)?facebook\.com\//i.test(txt)){
            fbUrl.value = txt.trim();
          }
        }catch(e){}
      })();
    })();
  </script>
</body>
</html>
